const settings=window.settings||{};document.addEventListener("DOMContentLoaded",function(){const toasts=document.querySelectorAll(".toast.show");toasts.forEach(function(toast){const bsToast=new bootstrap.Toast(toast,{autohide:true,delay:5e3});bsToast.show();toast.addEventListener("hidden.bs.toast",function(){toast.remove()})});document.querySelectorAll(".add-to-cart-form").forEach(function(form){form.addEventListener("submit",function(e){e.preventDefault();const formData=new FormData(this);const button=this.querySelector('button[type="submit"]');const productCard=this.closest(".product-card, .card");const productImage=productCard?productCard.querySelector("img"):null;button.disabled=true;const originalText=button.innerHTML;button.innerHTML='<i class="bi bi-hourglass-split"></i> Menambahkan...';fetch(base_url+"/cart/add",{method:"POST",body:formData,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(response=>response.json()).then(data=>{if(data.success){if(productImage){flyToCart(productImage)}updateCartBadge(data.totalItems);showNotification("success",data.message);setTimeout(function(){button.disabled=false;button.innerHTML=originalText},1e3)}else{button.disabled=false;button.innerHTML=originalText;if(data.redirect){window.location.href=data.redirect}else{showNotification("error",data.message)}}}).catch(error=>{button.disabled=false;button.innerHTML=originalText;showNotification("error","Terjadi kesalahan. Silakan coba lagi.")})})})});function flyToCart(productImage){const cart=document.querySelector(".bi-cart3");if(!cart||!productImage)return;const flyingImg=productImage.cloneNode();flyingImg.style.cssText=`\n        position: fixed;\n        z-index: 9999;\n        width: 80px;\n        height: 80px;\n        object-fit: cover;\n        border-radius: 8px;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n    `;const imgRect=productImage.getBoundingClientRect();const cartRect=cart.getBoundingClientRect();flyingImg.style.left=imgRect.left+"px";flyingImg.style.top=imgRect.top+"px";document.body.appendChild(flyingImg);setTimeout(function(){flyingImg.style.transition="all 0.8s cubic-bezier(0.5, 0, 0.5, 1)";flyingImg.style.left=cartRect.left+"px";flyingImg.style.top=cartRect.top+"px";flyingImg.style.width="20px";flyingImg.style.height="20px";flyingImg.style.opacity="0"},10);setTimeout(function(){flyingImg.remove();cart.style.animation="cartBounce 0.5s ease";setTimeout(()=>cart.style.animation="",500)},800)}function updateCartBadge(totalItems){let badge=document.querySelector(".cart-badge");const cartLink=document.querySelector(".bi-cart3").closest("a");if(totalItems>0){if(!badge){badge=document.createElement("span");badge.className="position-absolute translate-middle badge rounded-circle bg-danger cart-badge";badge.innerHTML='<span class="visually-hidden">items in cart</span>';cartLink.appendChild(badge)}badge.childNodes[0].textContent=totalItems>99?"99+":totalItems;badge.style.animation="none";setTimeout(()=>badge.style.animation="bounce 0.5s ease",10)}}function showNotification(type,message){const toastContainer=document.querySelector(".toast-container");const toastDiv=document.createElement("div");let iconClass,bgClass,heading,textColor;switch(type){case"success":iconClass="bi-check-circle-fill";bgClass="text-bg-success";heading="Berhasil!";textColor="text-white-50";break;case"error":iconClass="bi-exclamation-triangle-fill";bgClass="text-bg-danger";heading="Oops!";textColor="text-white-50";break;case"warning":iconClass="bi-exclamation-circle-fill";bgClass="text-bg-warning";heading="Perhatian!";textColor="text-dark-50";break;case"info":iconClass="bi-info-circle-fill";bgClass="text-bg-info";heading="Info!";textColor="text-white-50";break;default:iconClass="bi-info-circle-fill";bgClass="text-bg-primary";heading="Info!";textColor="text-white-50"}toastDiv.className=`toast align-items-center ${bgClass} border-0 shadow-lg`;toastDiv.setAttribute("role","alert");toastDiv.setAttribute("aria-live","assertive");toastDiv.setAttribute("aria-atomic","true");toastDiv.innerHTML=`\n        <div class="d-flex">\n            <div class="toast-body">\n                <div class="d-flex align-items-center">\n                    <i class="bi ${iconClass} fs-4 me-3"></i>\n                    <div>\n                        <strong>${heading}</strong><br>\n                        <small class="${textColor}">${message}</small>\n                    </div>\n                </div>\n            </div>\n            <button type="button" class="btn-close ${type==="warning"?"":"btn-close-white"} me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>\n    `;toastContainer.appendChild(toastDiv);const bsToast=new bootstrap.Toast(toastDiv,{autohide:true,delay:4e3});bsToast.show();toastDiv.addEventListener("hidden.bs.toast",function(){toastDiv.remove()})}window.toggleWishlist=function(button,produkId){if(!button||!produkId)return;const icon=button.querySelector("i");const originalClass=icon.className;button.disabled=true;const formData=new FormData;formData.append("produk_id",produkId);fetch(base_url+"/wishlist/toggle",{method:"POST",body:formData,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(response=>response.json()).then(data=>{if(data.success){if(data.isAdded){icon.classList.remove("bi-heart");icon.classList.add("bi-heart-fill")}else{icon.classList.remove("bi-heart-fill");icon.classList.add("bi-heart")}updateWishlistBadge(data.totalWishlist);showNotification("success",data.message)}else{icon.className=originalClass;if(data.redirect){window.location.href=data.redirect}else{showNotification("error",data.message)}}button.disabled=false}).catch(error=>{console.error("Error:",error);icon.className=originalClass;button.disabled=false;showNotification("error","Terjadi kesalahan. Silakan coba lagi.")})};function updateWishlistBadge(totalWishlist){let badge=document.querySelector(".wishlist-badge");const wishlistLink=document.querySelector(".bi-heart").closest("a");if(totalWishlist>0){if(!badge){badge=document.createElement("span");badge.className="position-absolute translate-middle badge rounded-circle bg-danger wishlist-badge";badge.innerHTML='<span class="visually-hidden">wishlist items</span>';wishlistLink.appendChild(badge)}badge.childNodes[0].textContent=totalWishlist>99?"99+":totalWishlist;badge.style.animation="none";setTimeout(()=>badge.style.animation="bounce 0.5s ease",10)}else{if(badge){badge.remove()}}}document.addEventListener("DOMContentLoaded",function(){const phoneNumber=settings.general.whatsapp_number||"6282183150556";const defaultMessage=settings.general.whatsapp_message||"Halo Souvnela, saya tertarik dengan produk souvenir Polinela.";const encodedMsg=encodeURIComponent(defaultMessage);const waUrl=`https://wa.me/${phoneNumber}?text=${encodedMsg}`;const waLink=document.getElementById("wa-link");if(waLink)waLink.href=waUrl});